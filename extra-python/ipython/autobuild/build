# Py2

python2 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/ipython_genutils-0.1.0
python2 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/pickleshare-0.7.3
python2 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/traitlets-4.2.2
python2 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/simplegeneric-0.8.1
python2 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

# hack to get around ipython collision
cd "$PKGDIR"/usr/share/man/man1/
for i in *; do
    mv $i ${i/%.1/2.1}
done
find "$PKGDIR"/usr/bin/ -type f -regex '.*[^2]$' -delete

cd "$SRCDIR/examples/IPython Kernel/"
sed -i 's/ython/ython2/g' *.desktop
sed -i 's/gnome-netstatus-idle/ipython2/' *.desktop
install -Dm644 ipython.desktop "$PKGDIR"/usr/share/applications/ipython2.desktop

cd "$SRCDIR"

# Py3

python3 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/ipython_genutils-0.1.0
python3 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/pickleshare-0.7.3
python3 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/traitlets-4.2.2
python3 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR"/simplegeneric-0.8.1
python3 setup.py install --prefix=/usr --root="$PKGDIR" --optimize=0

cd "$SRCDIR/examples/IPython Kernel/"
sed -i 's/ython2/ython3/g' *.desktop
sed -i 's/gnome-netstatus-idle/ipython/' *.desktop
install -Dm644 ipython.desktop "$PKGDIR"/usr/share/applications/ipython.desktop

cd "$SRCDIR"

rm "$PKGDIR"/usr/bin/ipython
ln -s /usr/bin/ipython2 "$PKGDIR"/usr/bin/ipython

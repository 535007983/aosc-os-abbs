From a5b3021db63c5b3ecd9d2e5165eedad1253beb8f Mon Sep 17 00:00:00 2001
From: liushuyu <liushuyu011@gmail.com>
Date: Sat, 15 Aug 2020 01:32:42 -0600
Subject: [PATCH] Allows X to work on the Lemote Yeeloong laptop

---
 hw/xfree86/dri/sarea.h                  | 2 ++
 hw/xfree86/os-support/linux/lnx_video.c | 5 ++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/hw/xfree86/dri/sarea.h b/hw/xfree86/dri/sarea.h
index 1bef2421e..5b96e9f48 100644
--- a/hw/xfree86/dri/sarea.h
+++ b/hw/xfree86/dri/sarea.h
@@ -41,6 +41,8 @@
 /* SAREA area needs to be at least a page */
 #if defined(__alpha__)
 #define SAREA_MAX 			0x2000
+#elif defined(__mips__)
+#define SAREA_MAX			0x4000
 #elif defined(__ia64__)
 #define SAREA_MAX			0x10000 /* 64kB */
 #else
diff --git a/hw/xfree86/os-support/linux/lnx_video.c b/hw/xfree86/os-support/linux/lnx_video.c
index 04e45092a..2c56d64e1 100644
--- a/hw/xfree86/os-support/linux/lnx_video.c
+++ b/hw/xfree86/os-support/linux/lnx_video.c
@@ -90,8 +90,11 @@ static Bool
 hwEnableIO(void)
 {
     int fd;
+#if defined(__mips__)
+    unsigned long ioBase_phys = 0x1fd00000;
+#else
     unsigned int ioBase_phys = syscall(__NR_pciconfig_iobase, 2, 0, 0);
-
+#endif
     fd = open("/dev/mem", O_RDWR);
     if (ioBase == NULL) {
         ioBase = (volatile unsigned char *) mmap(0, 0x20000,
-- 
2.28.0



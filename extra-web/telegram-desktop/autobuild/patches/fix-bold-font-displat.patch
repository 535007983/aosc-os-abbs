From 6c96fcc6ce5cb6c3560bd6c1faf2b3e70835ae5b Mon Sep 17 00:00:00 2001
From: Megumi_fox <i@megumifox.com>
Date: Sun, 26 Apr 2020 22:30:42 +0800
Subject: [PATCH] try fix font

---
 /Telegram/lib_ui/ui/style/style_core_font.cpp | 26 +++++++++++++++++---------
 1 file changed, 17 insertions(+), 9 deletions(-)

diff --git a/ui/style/style_core_font.cpp b/ui/style/style_core_font.cpp
index 0cd6580..00b2d50 100644
--- a/Telegram/lib_ui/ui/style/style_core_font.cpp
+++ b/Telegram/lib_ui/ui/style/style_core_font.cpp
@@ -85,6 +85,15 @@ bool LoadCustomFont(const QString &filePath, const QString &familyName, int flag
 	return ValidateFont(familyName, flags);
 }

+QString GeneralFont() {
+	static const auto family = [&]() -> QString {
+	const auto type = QFontDatabase::GeneralFont;
+	return QFontDatabase::systemFont(type).family();
+	}();
+
+	return family;
+}
+
 QString MonospaceFont() {
 	static const auto family = [&]() -> QString {
 #ifndef Q_OS_LINUX
@@ -245,9 +254,7 @@ QString GetPossibleEmptyOverride(int32 flags) {
 }

 QString GetFontOverride(int32 flags) {
-	const auto familyName = (flags & FontSemibold)
-		? "Open Sans Semibold"
-		: "Open Sans";
+	const auto familyName = GeneralFont();

 	const auto result = GetPossibleEmptyOverride(flags);
 	return result.isEmpty() ? familyName : result;
@@ -288,18 +295,19 @@ FontData::FontData(int size, uint32 flags, int family, Font *other)
 		f.setFamily(GetFontOverride(flags));
 	}

-#ifdef DESKTOP_APP_USE_PACKAGED_FONTS
-	if (_flags & FontSemibold) {
-		f.setWeight(QFont::DemiBold);
-	}
-#endif // DESKTOP_APP_USE_PACKAGED_FONTS
-
 	f.setPixelSize(size);
 	f.setBold(_flags & FontBold);
 	f.setItalic(_flags & FontItalic);
 	f.setUnderline(_flags & FontUnderline);
 	f.setStrikeOut(_flags & FontStrikeOut);

+#ifdef DESKTOP_APP_USE_PACKAGED_FONTS
+	if (_flags & FontSemibold) {
+		f.setWeight(QFont::DemiBold);
+        f.setStyleName("DemiBold");
+	}
+#endif // DESKTOP_APP_USE_PACKAGED_FONTS
+
 	m = QFontMetrics(f);
 	height = m.height();
 	ascent = m.ascent();
--
2.26.2



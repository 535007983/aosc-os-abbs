declare -A ARCH_MAP;
ARCH_DEF=$(dpkg --print-architecture)
ARCH_MAP=( ["amd64"]="64" ["armel"]="arm" ["arm64"]="arm64" ["mipsel"]="mipsle" ["mips64el"]="mips64le")
GO_ARCH=${ARCH_MAP["$ARCH_DEF"]}

export GOPATH="${SRCDIR}/build"
export BUILD_PATH="${GOPATH}/bin/v2ray-custom-linux-${GO_ARCH}"

mkdir ${GOPATH}

go get -u v2ray.com/core/...
go get -u v2ray.com/ext/...
go install v2ray.com/ext/tools/build/vbuild
${GOPATH}/bin/vbuild

install -Dm644 v2ray.service ${PKGDIR}/usr/lib/systemd/system/v2ray@.service
install -Dm644 ${BUILD_PATH}/systemd/v2ray.service ${pkgdir}/usr/lib/systemd/system/v2ray.service
sed -i 's/v2ray\/v2ray/v2ray/g' ${PKGDIR}/usr/lib/systemd/system/v2ray.service
install -Dm755 ${PKGDIR}/v2ray ${PKGDIR}/usr/bin/v2ray
install -Dm644 ${PKGDIR}/vpoint_socks_vmess.json ${PKGDIR}/etc/v2ray/vpoint_socks_vmess.json
install -Dm644 ${PKGDIR}/vpoint_vmess_freedom.json ${PKGDIR}/etc/v2ray/vpoint_vmess_freedom.json

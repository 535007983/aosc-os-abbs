ARCH_DEF=`dpkg --print-architecture`
if [[ ARCH_DEF == "amd64" ]]; then
    GO_ARCH="64";
elif [[ ARCH_DEF == "armel" ]]; then
    GO_ARCH="arm";
elif [[ ARCH_DEF == "arm64" ]]; then
    GO_ARCH="arm64";
elif [[ ARCH_DEF == "mipsel" ]]; then
    GO_ARCH="mipsle";
elif [[ ARCH_DEF == "mips64el" ]]; then
    GO_ARCH="mips64le";
else
    echo "What the shell with your architecture! QUIT!";
    exit 1;
fi

export GOPATH="${SRCDIR}/build"
export BUILD_PATH="${GOPATH}/bin/v2ray-custom-linux-${GO_ARCH}"

mkdir ${GOPATH}

go get -u v2ray.com/core/...
go get -u v2ray.com/ext/...
go install v2ray.com/ext/tools/build/vbuild
${GOPATH}/bin/vbuild

install -Dm644 v2ray.service ${PKGDIR}/usr/lib/systemd/system/v2ray@.service
install -Dm644 ${BUILD_PATH}/systemd/v2ray.service ${pkgdir}/usr/lib/systemd/system/v2ray.service
sed -i 's/v2ray\/v2ray/v2ray/g' ${PKGDIR}/usr/lib/systemd/system/v2ray.service
install -Dm755 ${PKGDIR}/v2ray ${PKGDIR}/usr/bin/v2ray
install -Dm644 ${PKGDIR}/vpoint_socks_vmess.json ${PKGDIR}/etc/v2ray/vpoint_socks_vmess.json
install -Dm644 ${PKGDIR}/vpoint_vmess_freedom.json ${PKGDIR}/etc/v2ray/vpoint_vmess_freedom.json

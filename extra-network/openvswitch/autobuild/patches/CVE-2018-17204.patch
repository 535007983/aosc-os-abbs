From 0e6eb58f53d63b79d3a8c6936b0ef72cdd082bdb Mon Sep 17 00:00:00 2001
From: Ben Pfaff <blp@ovn.org>
Date: Thu, 5 Jul 2018 15:28:51 -0700
Subject: [PATCH] ofp-group: Don't assert-fail decoding bad OF1.5 group mod
 type or command.

When decoding a group mod, the current code validates the group type and
command after the whole group mod has been decoded.  The OF1.5 decoder,
however, tries to use the type and command earlier, when it might still be
invalid.  This caused an assertion failure (via OVS_NOT_REACHED).  This
commit fixes the problem.

ovs-vswitchd does not enable support for OpenFlow 1.5 by default.

Reported-at: https://bugs.chromium.org/p/oss-fuzz/issues/detail?id=9249
Signed-off-by: Ben Pfaff <blp@ovn.org>
Reviewed-by: Yifeng Sun <pkusunyifeng@gmail.com>
---
 lib/ofp-util.c | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/lib/ofp-util.c b/lib/ofp-util.c
index adfc5fc36f..346e117023 100644
--- a/lib/ofp-util.c
+++ b/lib/ofp-util.c
@@ -9462,7 +9462,7 @@ parse_group_prop_ntr_selection_method(struct ofpbuf *payload,
                     "only allowed for select groups");
         return OFPERR_OFPBPC_BAD_VALUE;
     default:
-        OVS_NOT_REACHED();
+        return OFPERR_OFPGMFC_BAD_TYPE;
     }
 
     switch (group_cmd) {
@@ -9477,7 +9477,7 @@ parse_group_prop_ntr_selection_method(struct ofpbuf *payload,
                     "only allowed for add and delete group modifications");
         return OFPERR_OFPBPC_BAD_VALUE;
     default:
-        OVS_NOT_REACHED();
+        return OFPERR_OFPGMFC_BAD_COMMAND;
     }
 
     if (payload->size < sizeof *prop) {

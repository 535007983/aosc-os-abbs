#
# Before you start:
# LibreOffice can take an hour to build on a full Xeon E1230v3 machine with 
# 16GB of RAM, not to mention that even swap is used in the final linking.
#
# For your welfare and for the sake of packaging quality, do not build this
# before you are sure...
#
# It is recommended to find Jeff Bai (Me!) <jeffbaichina@members.fsf.org> for
# any help needed.
#

# System orcus disabled due to version conflicts.
# System opencollada disabled due to bug in autogen.sh (.
# System libjpeg-turbo disabled, mysterical fail during VCL build.
# System libglft disabled due to again, mysterical fail during VCL build.
# System libwps disabled due to too new of a version.

./autogen.sh \
             --with-build-version="5.0.0.5" \
             --with-vendor="Anthon Open Source Community" \
             --with-parallelism=16 \
             --disable-symbols \
             --without-java \
             --enable-verbose \
             --enable-release-build \
             --prefix=/opt/libreoffice-bundled --exec-prefix=/opt/libreoffice-bundled --sysconfdir=/etc/opt/libreoffice-bundled \
             --libdir=/opt/libreoffice-bundled/lib --mandir=/opt/libreoffice-bundled/share/man \
             --with-lang="" \
             --enable-crashdump \
             --enable-dbus \
             --enable-gio\
             --disable-gnome-vfs\
             --disable-kde\
             --disable-kde4\
             --disable-gstreamer-0-10 \
             --disable-gconf \
             --disable-lockdown \
             --enable-openssl \
             --disable-odk\
             --enable-orcus \
             --enable-python=system \
             --enable-scripting-javascript \
             --disable-telepathy \
             --enable-ext-wiki-publisher \
             --enable-ext-nlpsolver \
             --without-fonts\
             --without-system-npapi-headers \
             --without-system-boost\
             --without-system-hsqldb \
             --with-alloc=system \
             --without-system-jpeg \
             --disable-dependency-tracking \
             --enable-hardlink-deliver \
             --disable-cups --with-krb5=no --with-gssapi=no

sed -i '/CppunitTest_macros_test/d' sw/Module_sw.mk
sed -i '/CppunitTest_sd_tiledrendering/d' sd/Module_sd.mk
sed -i '/CppunitTest_sc_subsequent_filters_test/d' sc/Module_sc.mk
sed -i '/CppunitTest_sw_ww8export/d' sw/Module_sw.mk
sed -i '/CppunitTest_sw_ww8import/d' sw/Module_sw.mk

make build
make distro-pack-install DESTDIR=$PKGDIR 

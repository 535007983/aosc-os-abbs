cp $SRCDIR/autobuild/aosc-schema-bundle.conf $SRCDIR

package_list=()
source ./preset-packages.conf
source ./extra-packages.conf


for ((i=0; i<${#package_list[@]}; i++)); do
	package_list[$i]=rime/"${package_list[$i]}"
done

source ./aosc-schema-bundle.conf

abinfo "Cloning RIME official schema..."
for i in ${package_list[@]}; do
        abinfo "Cloning $i to package/rime..."
	owner=$(echo $i | cut -d '/' -f1)
	repo=$(echo $i | cut -d '/' -f2)
        git clone https://github.com/$owner/rime-$repo.git package/$owner/$repo
        cd package/$owner/$repo
        rev=${repo/\-/_}
        commit=$(eval echo \$${rev^^}_REV)
        git checkout $commit
        cd $SRCDIR
done

make all-bin
make DESTDIR="$PKGDIR" install

abinfo "Installing unofficial schema..."
$SRCDIR/rime-install 

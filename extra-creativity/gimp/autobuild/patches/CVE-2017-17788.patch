From 702c4227e8b6169f781e4bb5ae4b5733f51ab126 Mon Sep 17 00:00:00 2001
From: Hanno Boeck <hanno@hboeck.de>
Date: Mon, 27 Nov 2017 00:37:29 +0100
Subject: 790783 - buffer overread in XCF parser if version field...

...has no null terminator

Check for the presence of '\0' before using atoi() on the version
string. Patch slightly modified (mitch).
---
 app/xcf/xcf.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff -Naur gimp-2.8.22/app/xcf/xcf.c gimp-2.8.22.17788/app/xcf/xcf.c
--- gimp-2.8.22/app/xcf/xcf.c	2017-04-30 21:47:39.000000000 +0000
+++ gimp-2.8.22.17788/app/xcf/xcf.c	2017-12-24 06:32:12.838305015 +0000
@@ -318,7 +318,8 @@
         {
           info.file_version = 0;
         }
-      else if (id[9] == 'v')
+      else if (id[9]  == 'v' &&
+               id[13] == '\0')
         {
           info.file_version = atoi (id + 10);
         }

From 3f4ccde79a3d847fe36749c4aafd9dcbf1e9da03 Mon Sep 17 00:00:00 2001
From: Vasily Khoruzhick <anarsoul@gmail.com>
Date: Fri, 25 Oct 2019 19:08:57 -0700
Subject: [PATCH 09/34] lima: set dithering flag when necessary

Bit 13 in aux1 enables dithering

Reviewed-by: Qiang.Yu <yuq825@gmail.com>
Signed-off-by: Vasily Khoruzhick <anarsoul@gmail.com>
---
 .gitlab-ci/deqp-lima-fails.txt       | 10 ----------
 src/gallium/drivers/lima/lima_draw.c |  4 +++-
 2 files changed, 3 insertions(+), 11 deletions(-)

diff --git a/.gitlab-ci/deqp-lima-fails.txt b/.gitlab-ci/deqp-lima-fails.txt
index 3ff5aad49df..fa718e2b774 100644
--- a/.gitlab-ci/deqp-lima-fails.txt
+++ b/.gitlab-ci/deqp-lima-fails.txt
@@ -628,16 +628,6 @@ dEQP-GLES2.functional.depth_range.compare.half_to_zero Fail
 dEQP-GLES2.functional.depth_range.compare.one_to_half Fail
 dEQP-GLES2.functional.depth_range.compare.0_8_to_third Fail
 dEQP-GLES2.functional.depth_range.compare.half_to_half Fail
-dEQP-GLES2.functional.dither.disabled.gradient_white Fail
-dEQP-GLES2.functional.dither.disabled.gradient_red Fail
-dEQP-GLES2.functional.dither.disabled.gradient_green Fail
-dEQP-GLES2.functional.dither.disabled.gradient_blue Fail
-dEQP-GLES2.functional.dither.disabled.gradient_alpha Fail
-dEQP-GLES2.functional.dither.disabled.unicolored_quad_white Fail
-dEQP-GLES2.functional.dither.disabled.unicolored_quad_red Fail
-dEQP-GLES2.functional.dither.disabled.unicolored_quad_green Fail
-dEQP-GLES2.functional.dither.disabled.unicolored_quad_blue Fail
-dEQP-GLES2.functional.dither.disabled.unicolored_quad_alpha Fail
 dEQP-GLES2.functional.draw.draw_arrays.first.first_0 Fail
 dEQP-GLES2.functional.draw.draw_arrays.first.first_1 Fail
 dEQP-GLES2.functional.draw.draw_arrays.first.first_17 Fail
diff --git a/src/gallium/drivers/lima/lima_draw.c b/src/gallium/drivers/lima/lima_draw.c
index a607e874601..bb603d45180 100644
--- a/src/gallium/drivers/lima/lima_draw.c
+++ b/src/gallium/drivers/lima/lima_draw.c
@@ -1074,7 +1074,9 @@ lima_pack_render_state(struct lima_context *ctx, const struct pipe_draw_info *in
 
    /* more investigation */
    render->aux0 = 0x00000300 | (ctx->vs->varying_stride >> 3);
-   render->aux1 = 0x00003000;
+   render->aux1 = 0x00001000;
+   if (ctx->blend->base.dither)
+      render->aux1 |= 0x00002000;
 
    if (ctx->tex_stateobj.num_samplers) {
       render->textures_address =
-- 
2.23.0


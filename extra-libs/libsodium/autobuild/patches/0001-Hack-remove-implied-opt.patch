diff -Naur libsodium-1.0.16/configure.ac libsodium-1.0.16.opt/configure.ac
--- libsodium-1.0.16/configure.ac	2017-12-11 22:22:57.000000000 +0000
+++ libsodium-1.0.16.opt/configure.ac	2018-03-10 06:14:39.232469020 +0000
@@ -171,16 +171,6 @@
   ])
 ])
 
-AC_ARG_ENABLE(opt,
-[AS_HELP_STRING(--enable-opt,Optimize for the native CPU - The resulting library will be faster but not portable)],
-[
-  AS_IF([test "x$enableval" = "xyes"], [
-    AX_CHECK_COMPILE_FLAG([-Ofast], [CFLAGS="$CFLAGS -Ofast"])
-    AX_CHECK_COMPILE_FLAG([-fomit-frame-pointer], [CFLAGS="$CFLAGS -fomit-frame-pointer"])
-    AX_CHECK_COMPILE_FLAG([-march=native], [CFLAGS="$CFLAGS -march=native"])
-  ])
-])
-
 AC_SUBST([MAINT])
 
 AX_VALGRIND_CHECK
@@ -352,186 +342,6 @@
 
 dnl Checks for headers
 
-AS_IF([test "x$EMSCRIPTEN" = "x" -a "$host_os" != "pnacl"], [
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-mmmx], [CFLAGS="$CFLAGS -mmmx"])
-  AC_MSG_CHECKING(for MMX instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#pragma GCC target("mmx")
-#include <mmintrin.h>
-]], [[ __m64 x = _mm_setzero_si64(); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_MMINTRIN_H], [1], [mmx is available])
-     AX_CHECK_COMPILE_FLAG([-mmmx], [CFLAGS_MMX="-mmmx"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-msse2], [CFLAGS="$CFLAGS -msse2"])
-  AC_MSG_CHECKING(for SSE2 instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#pragma GCC target("sse2")
-#ifndef __SSE2__
-# define __SSE2__
-#endif
-#include <emmintrin.h>
-]], [[ __m128d x = _mm_setzero_pd();
-       __m128i z = _mm_srli_epi64(_mm_setzero_si128(), 26); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_EMMINTRIN_H], [1], [sse2 is available])
-     AX_CHECK_COMPILE_FLAG([-msse2], [CFLAGS_SSE2="-msse2"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-msse3], [CFLAGS="$CFLAGS -msse3"])
-  AC_MSG_CHECKING(for SSE3 instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#pragma GCC target("sse3")
-#include <pmmintrin.h>
-]], [[ __m128 x = _mm_addsub_ps(_mm_cvtpd_ps(_mm_setzero_pd()),
-                                _mm_cvtpd_ps(_mm_setzero_pd())); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_PMMINTRIN_H], [1], [sse3 is available])
-     AX_CHECK_COMPILE_FLAG([-msse3], [CFLAGS_SSE3="-msse3"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-mssse3], [CFLAGS="$CFLAGS -mssse3"])
-  AC_MSG_CHECKING(for SSSE3 instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#pragma GCC target("ssse3")
-#include <tmmintrin.h>
-]], [[ __m64 x = _mm_abs_pi32(_m_from_int(0)); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_TMMINTRIN_H], [1], [ssse3 is available])
-     AX_CHECK_COMPILE_FLAG([-mssse3], [CFLAGS_SSSE3="-mssse3"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-msse4.1], [CFLAGS="$CFLAGS -msse4.1"])
-  AC_MSG_CHECKING(for SSE4.1 instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#pragma GCC target("sse4.1")
-#include <smmintrin.h>
-]], [[ __m128i x = _mm_minpos_epu16(_mm_setzero_si128()); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_SMMINTRIN_H], [1], [sse4.1 is available])
-     AX_CHECK_COMPILE_FLAG([-msse4.1], [CFLAGS_SSE41="-msse4.1"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-mavx], [CFLAGS="$CFLAGS -mavx"])
-  AC_MSG_CHECKING(for AVX instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifdef __native_client__
-# error NativeClient detected - Avoiding AVX opcodes
-#endif
-#pragma GCC target("avx")
-#include <immintrin.h>
-]], [[ _mm256_zeroall(); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_AVXINTRIN_H], [1], [AVX is available])
-     AX_CHECK_COMPILE_FLAG([-mavx], [CFLAGS_AVX="-mavx"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-mavx2], [CFLAGS="$CFLAGS -mavx2"])
-  AC_MSG_CHECKING(for AVX2 instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifdef __native_client__
-# error NativeClient detected - Avoiding AVX2 opcodes
-#endif
-#pragma GCC target("avx2")
-#include <immintrin.h>
-]], [[
-__m256 x = _mm256_set1_ps(3.14);
-__m256 y = _mm256_permutevar8x32_ps(x, _mm256_set1_epi32(42));
-return _mm256_movemask_ps(_mm256_cmp_ps(x, y, _CMP_NEQ_OQ));
-]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_AVX2INTRIN_H], [1], [AVX2 is available])
-     AX_CHECK_COMPILE_FLAG([-mavx2], [CFLAGS_AVX2="-mavx2"])
-     AC_MSG_CHECKING(if _mm256_broadcastsi128_si256 is correctly defined)
-     AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifdef __native_client__
-# error NativeClient detected - Avoiding AVX2 opcodes
-#endif
-#pragma GCC target("avx2")
-#include <immintrin.h>
-     ]], [[ __m256i y = _mm256_broadcastsi128_si256(_mm_setzero_si128()); ]])],
-       [AC_MSG_RESULT(yes)],
-       [AC_MSG_RESULT(no)
-        AC_DEFINE([_mm256_broadcastsi128_si256], [_mm_broadcastsi128_si256],
-                  [Define to the local name of _mm256_broadcastsi128_si256])])
-     ],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-mavx512f], [CFLAGS="$CFLAGS -mavx512f"])
-  AC_MSG_CHECKING(for AVX512F instructions set)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifdef __native_client__
-# error NativeClient detected - Avoiding AVX512F opcodes
-#endif
-#pragma GCC target("avx512f")
-#include <immintrin.h>
-]], [[
-__m512i x = _mm512_setzero_epi32();
-__m512i y = _mm512_permutexvar_epi64(_mm512_setr_epi64(0, 1, 4, 5, 2, 3, 6, 7), x);
-]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_AVX512FINTRIN_H], [1], [AVX512F is available])
-     AX_CHECK_COMPILE_FLAG([-mavx512f], [CFLAGS_AVX512F="-mavx512f"])],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-maes], [CFLAGS="$CFLAGS -maes"])
-  AX_CHECK_COMPILE_FLAG([-mpclmul], [CFLAGS="$CFLAGS -mpclmul"])
-  AC_MSG_CHECKING(for AESNI instructions set and PCLMULQDQ)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifdef __native_client__
-# error NativeClient detected - Avoiding AESNI opcodes
-#endif
-#pragma GCC target("aes")
-#pragma GCC target("pclmul")
-#include <wmmintrin.h>
-]], [[ __m128i x = _mm_aesimc_si128(_mm_setzero_si128());
-       __m128i y = _mm_clmulepi64_si128(_mm_setzero_si128(), _mm_setzero_si128(), 0);]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_WMMINTRIN_H], [1], [aesni is available])
-     AX_CHECK_COMPILE_FLAG([-maes], [CFLAGS_AESNI="-maes"])
-     AX_CHECK_COMPILE_FLAG([-mpclmul], [CFLAGS_PCLMUL="-mpclmul"])
-     ],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-  oldcflags="$CFLAGS"
-  AX_CHECK_COMPILE_FLAG([-mrdrnd], [CFLAGS="$CFLAGS -mrdrnd"])
-  AC_MSG_CHECKING(for RDRAND)
-  AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-#ifdef __native_client__
-# error NativeClient detected - Avoiding RDRAND opcodes
-#endif
-#pragma GCC target("rdrnd")
-#include <immintrin.h>
-]], [[ unsigned long long x; _rdrand64_step(&x); ]])],
-    [AC_MSG_RESULT(yes)
-     AC_DEFINE([HAVE_RDRAND], [1], [rdrand is available])
-     AX_CHECK_COMPILE_FLAG([-mrdrnd], [CFLAGS_RDRAND="-mrdrnd"])
-     ],
-    [AC_MSG_RESULT(no)])
-  CFLAGS="$oldcflags"
-
-])
-
 AC_SUBST(CFLAGS_MMX)
 AC_SUBST(CFLAGS_SSE2)
 AC_SUBST(CFLAGS_SSE3)

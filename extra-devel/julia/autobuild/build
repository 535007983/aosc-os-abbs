make prefix=/usr sysconfdir=/etc \
     JULIA_BUILD_MODE=release \
     USE_SYSTEM_LLVM=0 \
     USE_SYSTEM_LIBUV=0 \
     USE_SYSTEM_LIBM=0 \
     USE_SYSTEM_OPENLIBM=0 \
     USE_SYSTEM_BLAS=1 \
     USE_SYSTEM_LAPACK=1 \
     USE_INTEL_MKL=0 \
     USE_SYSTEM_SUITESPARSE=0 \
     USE_SYSTEM_PCRE=1 \
     USE_SYSTEM_GMP=1 \
     USE_SYSTEM_MPFR=1 \
     USE_SYSTEM_LIBGIT2=1 \
     USE_SYSTEM_CURL=1 \
     USE_SYSTEM_LIBSSH2=1 \
     USE_SYSTEM_MBEDTLS=1 \
     USE_SYSTEM_UTF8PROC=0 \
     USE_SYSTEM_LIBUNWIND=1 \
     julia-deps

cd ${SRCDIR}/src

# This is nasty, but it seems to build ... wtf?
make prefix=/usr sysconfdir=/etc \
     JULIA_BUILD_MODE=release \
     USE_SYSTEM_LLVM=0 \
     USE_SYSTEM_LIBUV=0 \
     USE_SYSTEM_LIBM=0 \
     USE_SYSTEM_OPENLIBM=0 \
     USE_SYSTEM_BLAS=1 \
     USE_SYSTEM_LAPACK=1 \
     USE_INTEL_MKL=0 \
     USE_SYSTEM_SUITESPARSE=0 \
     USE_SYSTEM_PCRE=1 \
     USE_SYSTEM_GMP=1 \
     USE_SYSTEM_MPFR=1 \
     USE_SYSTEM_LIBGIT2=1 \
     USE_SYSTEM_CURL=1 \
     USE_SYSTEM_LIBSSH2=1 \
     USE_SYSTEM_MBEDTLS=1 \
     USE_SYSTEM_UTF8PROC=0 \
     USE_SYSTEM_LIBUNWIND=1 \
     interpreter.o

cd ${SRCDIR}

make prefix=/usr sysconfdir=/etc \
     JULIA_BUILD_MODE=release \
     USE_SYSTEM_LLVM=0 \
     USE_SYSTEM_LIBUV=0 \
     USE_SYSTEM_LIBM=0 \
     USE_SYSTEM_OPENLIBM=0 \
     USE_SYSTEM_BLAS=1 \
     USE_SYSTEM_LAPACK=1 \
     USE_INTEL_MKL=0 \
     USE_SYSTEM_SUITESPARSE=0 \
     USE_SYSTEM_PCRE=1 \
     USE_SYSTEM_GMP=1 \
     USE_SYSTEM_MPFR=1 \
     USE_SYSTEM_LIBGIT2=1 \
     USE_SYSTEM_CURL=1 \
     USE_SYSTEM_LIBSSH2=1 \
     USE_SYSTEM_MBEDTLS=1 \
     USE_SYSTEM_UTF8PROC=1 \
     USE_SYSTEM_LIBUNWIND=1

# Patch Pkg to build docs correctly
cp autobuild/docs.patch usr/share/julia/stdlib/v1.0/Pkg/src/docs.patch
cd usr/share/julia/stdlib/v1.0/Pkg/src
patch < docs.patch
cd $SRCDIR

make DESTDIR="$PKGDIR" \
     prefix=/usr sysconfdir=/etc \
     JULIA_BUILD_MODE=release \
     USE_SYSTEM_LLVM=0 \
     USE_SYSTEM_LIBUV=0 \
     USE_SYSTEM_LIBM=0 \
     USE_SYSTEM_OPENLIBM=0 \
     USE_SYSTEM_BLAS=1 \
     USE_SYSTEM_LAPACK=1 \
     USE_INTEL_MKL=0 \
     USE_SYSTEM_SUITESPARSE=0 \
     USE_SYSTEM_PCRE=1 \
     USE_SYSTEM_GMP=1 \
     USE_SYSTEM_MPFR=1 \
     USE_SYSTEM_LIBGIT2=1 \
     USE_SYSTEM_CURL=1 \
     USE_SYSTEM_LIBSSH2=1 \
     USE_SYSTEM_MBEDTLS=1 \
     USE_SYSTEM_UTF8PROC=1 \
     USE_SYSTEM_LIBUNWIND=1 \
     install

PKGNAME=fwupd
PKGSEC=admin
PKGDEP="appstream-glib colord gcab gpgme libarchive libsoup polkit sqlite \
        systemd libxmlb python-3 libgusb json-glib pycairo efivar gnutls \
        polkit shared-mime-info modemmanager glib libgpg-error elfutils \
        colord systemd dbus pillow pygobject-3 pango"
BUILDDEP="docbook-sgml gtk-doc gobject-introspection intltool meson vala \
          valgrind pkg-config"
PKGDES="Firmware update daemon and utilities"

MESON_AFTER="-Dagent=true
             -Dgtkdoc=true \
             -Dgpg=true \
             -Dman=true \
             -Dpkcs7=true \
             -Dplugin_modem_manager=true \
             -Dplugin_nvme=true \
             -Dplugin_redfish=true \
             -Dsystemd=true \
             -Dconsolekit=true \
             -Dtests=false"

if [[ "${CROSS:-$ARCH}" = "amd64" ]]; then
    MESON_AFTER+=" -Denable-thunderbolt=true \
                   -Dplugin_dell=true \
                   -Dplugin_synaptics=true"
    BUILDDEP+=" libsmbios thunderbolt-software-user-space"
else
    MESON_AFTER+=" -Denable-thunderbolt=false \
                   -Dplugin_dell=false \
                   -Dplugin_synaptics=false"
fi
if [[ "${CROSS:-$ARCH}" != mips* && "${CROSS:-$ARCH}" != "powerpc" && \
      "${CROSS:-$ARCH}" != "ppc64" ]]; then
    BUILDDEP+=" fontconfig freetype dejavu-fonts gnu-efi cairo"
    MESON_AFTER+=" -Dplugin_uefi=true"
fi

PKGBREAK="gnome-software<=3.26.1"
